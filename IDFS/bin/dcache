#!/usr/bin/env python3
# -*- coding: utf-8 -*-          
import os
import sys
import stat
import datetime
import logging
import getpass

logfile_path = "/home/IDFS/var/log/logfile.log"

logging.basicConfig(filename=logfile_path, level=logging.DEBUG, format="%(user)s | %(levelname)s | %(asctime)s | %(message)s")
user = getpass.getuser()
logger = logging.getLogger(__name__)
logger = logging.LoggerAdapter(logger, {"user": user})

def fct_l(directory='.', long_format=False):
    try:
        files = os.listdir(directory)
        for file in files:
            file_path = os.path.join(directory, file)
            if long_format:
                file_info = os.stat(file_path)
                mode = stat.filemode(file_info.st_mode)
                size = file_info.st_size
                mtime = datetime.datetime.fromtimestamp(file_info.st_mtime).strftime('%Y-%m-%d %H:%M:%S')
                print(f"{mode} {size:8} {mtime} {file}")
                logger.info("Affichage des informations du contenu du repertoire actuel")
            else:
                print(file)
                logger.info("Ce n'est pas un repertoire")
    except FileNotFoundError:
        print(f"Le repertoire '{directory}' n'a pas ete trouve.")
        logger.error("Le repertoire n'existe pas")
    except Exception as e:
        print(f"Une erreur s'est produite : {e}")
        logger.error("Erreur")

if __name__ == "__main__":
    if len(sys.argv) < 2:
        fct_l()
        logger.info("Affichage du contenu du repertoire actuel")


